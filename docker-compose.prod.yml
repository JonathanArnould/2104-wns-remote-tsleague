services:
    client:
        build: ./client
        command: sh -c "npm run build"
        volumes:
            - ./client/src:/app/src
            - web-client-build:/app/build
    server:
        build: ./server
        ports:
            - 5000
        command: sh -c "npm run prod"
        volumes:
            - ./server/src:/server/src
    nginx:
        image: nginx:1.21.3
        depends_on:
            - server
            - client
        restart: always
        ports:
            - ${GATEWAY_PORT}:80
        volumes:
            - ./nginx.conf:/etc/nginx/nginx.conf
            - web-client-build:/web-client-build
volumes:
    web-client-build:
